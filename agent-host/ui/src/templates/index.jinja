<!DOCTYPE html>
<html lang="en" data-bs-theme="light">

<head>
    <!-- Theme initialization script (runs before body to prevent flash) -->
    <script>
        (function () {
            const stored = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = stored || (prefersDark ? 'dark' : 'light');
            document.documentElement.setAttribute('data-bs-theme', theme);
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../styles/main.scss">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ¤–</text></svg>">
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <h1 class="app-title">
                    <i class="bi bi-robot"></i>
                    {{ app_name }}
                </h1>
            </div>
            <div class="header-right">
                <div id="user-info" class="user-info d-none">
                    <span class="user-name"></span>
                    <!-- Theme Toggle -->
                    <button class="btn btn-outline-light btn-sm" id="theme-toggle" title="Toggle theme">
                        <i class="bi bi-sun-fill" id="theme-icon-light"></i>
                        <i class="bi bi-moon-fill d-none" id="theme-icon-dark"></i>
                    </button>
                    <button class="btn btn-outline-light btn-sm" id="logout-btn">
                        <i class="bi bi-box-arrow-right"></i>
                        Logout
                    </button>
                </div>
                <a href="/api/auth/login" id="login-btn" class="btn btn-primary btn-sm">
                    <i class="bi bi-box-arrow-in-right"></i>
                    Login
                </a>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <div class="chat-container">
                <!-- Sidebar -->
                <aside class="chat-sidebar" id="chat-sidebar">
                    <div class="sidebar-header">
                        <h2>Conversations</h2>
                        <button class="btn btn-outline-primary btn-sm" id="new-chat-btn" title="New conversation">
                            <i class="bi bi-plus-lg"></i>
                        </button>
                    </div>
                    <div class="conversation-list" id="conversation-list">
                        <!-- Conversations loaded dynamically -->
                    </div>
                    <div class="sidebar-footer">
                        <button class="btn btn-outline-secondary btn-sm" id="tools-btn" title="View available tools">
                            <i class="bi bi-tools"></i>
                            Tools
                        </button>
                    </div>
                </aside>

                <!-- Chat Area -->
                <div class="chat-area">
                    <!-- Messages -->
                    <div class="messages-container" id="messages-container">
                        <div class="welcome-message" id="welcome-message">
                            <div class="welcome-icon">
                                <i class="bi bi-chat-dots"></i>
                            </div>
                            <h2>Welcome to {{ app_name }}</h2>
                            <p>Your AI assistant with access to powerful tools.</p>
                            <p class="text-muted">Login to start chatting.</p>
                        </div>
                    </div>

                    <!-- Input Area -->
                    <div class="input-area">
                        <form id="chat-form" class="chat-form">
                            <div class="input-group">
                                <textarea id="message-input" class="form-control" placeholder="Type your message..."
                                    rows="1" disabled></textarea>
                                <button type="submit" class="btn btn-primary" id="send-btn" disabled>
                                    <i class="bi bi-send"></i>
                                </button>
                            </div>
                        </form>
                        <div class="input-info">
                            <span class="status-indicator" id="status-indicator">
                                <i class="bi bi-circle-fill"></i>
                                <span class="status-text">Disconnected</span>
                            </span>
                            <span class="tools-indicator" id="tools-indicator" title="Available tools">
                                <i class="bi bi-tools"></i>
                                <span class="tools-count">0</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Tools Modal -->
        <div class="modal fade" id="tools-modal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="bi bi-tools"></i>
                            Available Tools
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" id="tools-list">
                        <!-- Tools loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Rename Conversation Modal -->
        <div class="modal fade" id="rename-modal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="bi bi-pencil"></i>
                            Rename Conversation
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="rename-input" class="form-label">Conversation title</label>
                            <input type="text" class="form-control" id="rename-input" placeholder="Enter new title">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="rename-confirm-btn">Rename</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="delete-modal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title text-danger">
                            <i class="bi bi-trash"></i>
                            Delete Conversation
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete "<strong id="delete-conversation-title"></strong>"?</p>
                        <p class="text-muted mb-0">This action cannot be undone.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="delete-confirm-btn">Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Container for notifications -->
        <div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3"></div>
    </div>

    <script type="module" src="../scripts/main.js"></script>
</body>

</html>
