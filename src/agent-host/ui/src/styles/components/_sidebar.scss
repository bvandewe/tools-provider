// =============================================================================
// SIDEBAR COMPONENT
// Conversation list and sidebar navigation
// =============================================================================

.chat-sidebar {
    width: $sidebar-width;
    min-width: 0; // Allow shrinking to 0
    background: var(--bs-body-bg);
    border-right: 1px solid var(--bs-border-color);
    display: flex;
    flex-direction: column;
    flex-shrink: 0; // Don't shrink unless collapsed
    transition:
        width $transition-normal ease,
        transform $transition-normal ease;

    // Collapsed state (desktop)
    &.collapsed {
        width: 0 !important;
        min-width: 0 !important;
        overflow: hidden;
        border-right: none;
        visibility: hidden; // Ensure content is fully hidden

        // Hide all children
        > * {
            opacity: 0;
            visibility: hidden;
        }
    }
}

.sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border-bottom: 1px solid var(--bs-border-color);

    .sidebar-title-area {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    h2 {
        font-size: 1rem;
        font-weight: 600;
        margin: 0;
        color: var(--bs-body-color);
    }

    .sidebar-header-actions {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }
}

// Sidebar Mode Selector
.sidebar-mode-selector {
    .sidebar-mode-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        padding: 0;
        border: 1px solid var(--bs-border-color);
        border-radius: $border-radius-md;
        background: var(--bs-tertiary-bg);
        color: var(--bs-body-color);
        transition: all $transition-fast;

        &:hover {
            background: var(--bs-secondary-bg);
            border-color: $primary;
            color: $primary;
        }

        &::after {
            display: none; // Hide dropdown caret
        }

        .sidebar-mode-icon {
            font-size: 1rem;
        }
    }

    .sidebar-mode-menu {
        min-width: 240px;
        padding: 0.5rem 0;
        border-radius: $border-radius-lg;
        box-shadow: $shadow-lg;

        .dropdown-header {
            padding: 0.5rem 1rem 0.25rem;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--bs-secondary);
        }

        .dropdown-item {
            padding: 0.5rem 1rem;
            display: flex;
            flex-direction: column;
            align-items: flex-start;

            &.active {
                background: var(--bs-primary-bg-subtle);
                color: var(--bs-primary);

                &::before {
                    content: 'âœ“';
                    position: absolute;
                    right: 1rem;
                    color: var(--bs-primary);
                }
            }

            &:hover:not(.active) {
                background: var(--bs-tertiary-bg);
            }

            small {
                font-size: 0.7rem;
                margin-top: 0.125rem;
            }
        }

        .dropdown-divider {
            margin: 0.375rem 0;
        }
    }
}

// Conversation List
.conversation-list {
    flex: 1;
    overflow-y: auto;
    padding: 0.5rem;

    // Disabled state for proactive sessions (still visible but interactions disabled)
    &.interactions-disabled {
        opacity: 0.6;
        pointer-events: none;
    }
}

.conversation-item {
    display: flex;
    flex-direction: column;
    padding: 0.75rem 1rem;
    border-radius: $border-radius-md;
    cursor: pointer;
    margin-bottom: 0.25rem;
    transition: background $transition-fast;

    &:hover {
        background: var(--bs-tertiary-bg);

        .conversation-actions {
            opacity: 1;
        }
    }

    &.active {
        background: rgba($primary, 0.15);
        color: $primary;
        border-left: 3px solid $primary;
    }

    // Pinned conversation styling
    &.pinned {
        border-left: 2px solid $warning;
        background: rgba($warning, 0.05);

        &:hover {
            background: rgba($warning, 0.1);
        }

        // Pinned AND active - greenish border (blue + yellow)
        &.active {
            border-left: 3px solid #5cb85c; // Green
            background: rgba(#5cb85c, 0.1);
        }

        .pin-indicator {
            color: $warning;
            font-size: 0.7rem;
            margin-right: 0.25rem;
            flex-shrink: 0;
        }
    }

    // Agent icon spacing
    .conversation-agent-icon {
        margin-right: 0.375rem;
        flex-shrink: 0;
        font-size: 0.9rem;
        opacity: 0.8;
    }

    .conversation-content {
        flex: 1;
        min-width: 0; // Allow text truncation
        width: 100%;
    }

    .conversation-title-wrapper {
        display: flex;
        align-items: center;
    }

    .conversation-title {
        font-size: 0.875rem;
        font-weight: 500;
        margin: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .conversation-meta-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 0.25rem;
    }

    .conversation-meta {
        font-size: 0.75rem;
        color: var(--bs-secondary-color);
        margin: 0;
        flex-shrink: 0;
    }
}

// Session Item Styling (inherits from conversation-item)
.session-item {
    .badge {
        font-size: 0.6rem;
        padding: 0.2em 0.4em;
        font-weight: 500;
    }

    .session-type-icon {
        font-size: 0.875rem;
        flex-shrink: 0;
    }

    // Allow action buttons on session items
    &:hover .conversation-actions {
        opacity: 1;
    }

    // Pinned session styling (inherit from conversation-item.pinned)
    &.pinned {
        border-left: 2px solid $warning;
        background: rgba($warning, 0.05);

        &:hover {
            background: rgba($warning, 0.1);
        }
    }
}

// Conversation Action Buttons
.conversation-actions {
    display: flex;
    gap: 0.25rem;
    opacity: 0;
    transition: opacity $transition-fast;
    margin-left: 0.5rem;

    .btn-action {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        padding: 0;
        border: none;
        border-radius: $border-radius-sm;
        background: transparent;
        color: var(--bs-secondary-color);
        cursor: pointer;
        transition: all $transition-fast;

        &:hover {
            background: var(--bs-tertiary-bg);
            color: $primary;
        }

        &.btn-pin:hover,
        &.btn-pin.active {
            background: rgba($warning, 0.1);
            color: $warning;
        }

        &.btn-share:hover {
            background: rgba($success, 0.1);
            color: $success;
        }

        &.btn-info-conv:hover {
            background: rgba($info, 0.1);
            color: $info;
        }

        &.btn-delete:hover {
            background: rgba($danger, 0.1);
            color: $danger;
        }

        i {
            font-size: 0.875rem;
        }
    }
}

// Sidebar Footer
.sidebar-footer {
    padding: 0.75rem 1rem;
    border-top: 1px solid var(--bs-border-color);
    background: var(--bs-body-bg);

    .footer-content {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        font-size: 0.75rem;
        color: var(--bs-secondary-color);
    }

    .app-tag {
        font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
        background: var(--bs-tertiary-bg);
        padding: 0.125rem 0.5rem;
        border-radius: $border-radius-sm;
    }

    .copyright {
        white-space: nowrap;
    }

    .github-link {
        color: var(--bs-secondary-color);
        transition: color $transition-fast;
        font-size: 1rem;

        &:hover {
            color: var(--bs-body-color);
        }
    }
}

// Sidebar Overlay (mobile)
.sidebar-overlay {
    display: none;
    position: fixed;
    top: $header-height;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: $z-sidebar-overlay;
    opacity: 0;
    transition: opacity $transition-normal ease;

    &.active {
        display: block;
        opacity: 1;
    }
}
