{# =============================================================================
HEADER PARTIAL
App header with branding, navigation, and user controls
============================================================================= #}

<header class="app-header">
    <div class="header-left">
        <!-- Sidebar Toggle (visible when sidebar is collapsed) -->
        <button class="btn btn-link sidebar-toggle" id="sidebar-toggle-btn" title="Show sidebar">
            <i class="bi bi-layout-sidebar"></i>
        </button>
        <h1 class="app-title">
            <a href="#" id="app-title-link" class="app-title-link" data-bs-toggle="tooltip" data-bs-placement="bottom"
                title="Click to return to Welcome view">
                <i class="bi bi-robot"></i>
                <span class="app-title-text" id="header-app-name">{{ app_name }}</span>
            </a>
        </h1>
        <!-- Agent Selector Dropdown (after page title) -->
        <div class="dropdown header-agent-selector d-none" id="header-agent-selector">
            <button class="btn btn-link dropdown-toggle" type="button" id="header-agent-selector-btn"
                data-bs-toggle="dropdown" aria-expanded="false" title="Select agent">
                <i class="bi bi-robot" id="header-selected-agent-icon"></i>
                <span class="header-selected-agent-name" id="header-selected-agent-name"></span>
            </button>
            <ul class="dropdown-menu header-agent-menu" id="header-agent-menu"
                aria-labelledby="header-agent-selector-btn">
                <!-- Agent options populated by JavaScript -->
            </ul>
        </div>
    </div>

    <div class="header-center">
        <!-- Agent/Mode Selector - Hidden, now in sidebar -->
        <div class="dropdown agent-selector d-none" id="agent-selector" style="display: none !important;">
            <button class="btn btn-outline-secondary dropdown-toggle agent-selector-btn" type="button"
                id="agent-selector-btn" data-bs-toggle="dropdown" aria-expanded="false" title="Select mode">
                <i class="bi bi-chat-dots mode-icon"></i>
                <span class="mode-label">Chat</span>
            </button>
            <ul class="dropdown-menu agent-selector-menu" aria-labelledby="agent-selector-btn">
                <!-- Chat Mode -->
                <li>
                    <button class="dropdown-item active" type="button" data-mode="chat" id="chat-mode-btn">
                        <i class="bi bi-chat-dots me-2"></i>
                        Chat
                        <small class="text-muted d-block">Regular conversation with AI</small>
                    </button>
                </li>
                <li>
                    <hr class="dropdown-divider">
                </li>

                <!-- Learning Sessions -->
                <li class="dropdown-header">
                    <i class="bi bi-mortarboard me-1"></i>
                    Learning Sessions
                </li>
                <!-- Category buttons populated dynamically by session-mode-manager.js -->
                <div id="learning-category-list">
                    <!-- Categories will be inserted here -->
                </div>
                <li>
                    <hr class="dropdown-divider">
                </li>

                <!-- Thought Session -->
                <li>
                    <button class="dropdown-item" type="button" data-mode="thought" id="thought-mode-btn">
                        <i class="bi bi-lightbulb me-2"></i>
                        Thought Session
                        <small class="text-muted d-block">AI-guided brainstorming</small>
                    </button>
                </li>
            </ul>
        </div>
    </div>

    <div class="header-right">
        <!-- New Conversation Button (always visible, disabled until agent selected) -->
        <button class="btn btn-link new-chat-btn" id="new-chat-btn" title="New conversation" disabled>
            <i class="bi bi-plus-lg"></i>
        </button>
        <!-- Theme Toggle -->
        <button class="btn btn-link theme-toggle" id="theme-toggle" title="Toggle theme">
            <i class="bi bi-sun-fill" id="theme-icon-light"></i>
            <i class="bi bi-moon-fill d-none" id="theme-icon-dark"></i>
        </button>
        <!-- Admin Tools Provider Link (shown for admin users only) -->
        <a class="btn btn-link admin-tools-btn d-none" id="admin-tools-btn" href="#" target="_blank"
            title="Tools Provider">
            <i class="bi bi-tools"></i>
        </a>
        <!-- Admin Settings Button (shown for admin users only) -->
        <button class="btn btn-link admin-settings-btn d-none" id="admin-settings-btn" title="Application Settings">
            <i class="bi bi-gear"></i>
        </button>
        <!-- User Dropdown (shown when logged in) -->
        <div class="dropdown d-none" id="user-dropdown">
            <button class="btn btn-link dropdown-toggle" type="button" id="user-dropdown-btn" data-bs-toggle="dropdown"
                aria-expanded="false" title="User menu">
                <i class="bi bi-person-circle"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="user-dropdown-btn">
                <li><span class="dropdown-item-text fw-medium" id="dropdown-user-name">User</span></li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li>
                    <button class="dropdown-item" id="my-permissions-btn">
                        <i class="bi bi-shield-check me-2"></i>My Permissions
                    </button>
                </li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li>
                    <button class="dropdown-item text-danger" id="delete-all-unpinned-btn">
                        <i class="bi bi-trash me-2"></i>Delete All Unpinned
                    </button>
                </li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li>
                    <button class="dropdown-item" id="logout-btn">
                        <i class="bi bi-box-arrow-right me-2"></i>Logout
                    </button>
                </li>
            </ul>
        </div>

        <!-- Login Button (shown when not logged in) -->
        <a href="/api/auth/login" id="login-btn" class="btn btn-primary btn-sm">
            <i class="bi bi-box-arrow-in-right"></i>
            <span class="login-text">Login</span>
        </a>
    </div>
</header>
